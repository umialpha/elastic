[INFO] 2020-03-12 08:15:49,938 main: rdzv init method=etcd://etcd:2379/imagenet?min_workers=1&max_workers=4&last_call_timeout=5
[INFO] 2020-03-12 08:15:49,938 main: Loading data from: /data/tiny-imagenet-200/train
[INFO] 2020-03-12 08:16:18,882 main: Loading model: resnet101
[INFO] 2020-03-12 08:16:22,032 main: Rank [0] running on GPU [0]
INFO 2020-03-12 08:16:22,038 Etcd machines: ['http://0.0.0.0:2379']
[INFO] 2020-03-12 08:16:22,088 main: Entering torchelastic train_loop
INFO 2020-03-12 08:16:22,089 Attempting to join next rendezvous
INFO 2020-03-12 08:16:22,104 Observed existing rendezvous state: {'status': 'final', 'version': '140', 'participants': [0, 1], 'keep_alives': ['/torchelastic/p2p/run_imagenet/rdzv/v_140/rank_1', '/torchelastic/p2p/run_imagenet/rdzv/v_140/rank_0'], 'num_workers_waiting': 3}
INFO 2020-03-12 08:16:22,144 Added self to waiting list. Rendezvous full state: {"status": "final", "version": "140", "participants": [0, 1], "keep_alives": ["/torchelastic/p2p/run_imagenet/rdzv/v_140/rank_1", "/torchelastic/p2p/run_imagenet/rdzv/v_140/rank_0"], "num_workers_waiting": 4}
INFO 2020-03-12 08:16:22,730 Keep-alive key /torchelastic/p2p/run_imagenet/rdzv/v_140/rank_1 is not renewed.
INFO 2020-03-12 08:16:22,730 Rendevous version 140 is incomplete. 
INFO 2020-03-12 08:16:22,731 Attempting to destroy it.
INFO 2020-03-12 08:16:22,744 Rendezvous attempt failed, will retry. Reason: Key not found : /torchelastic/p2p/run_imagenet/rdzv/active_version
INFO 2020-03-12 08:16:23,745 Attempting to join next rendezvous
INFO 2020-03-12 08:16:23,760 Observed existing rendezvous state: {'status': 'joinable', 'version': '141', 'participants': [0, 1]}
INFO 2020-03-12 08:16:23,852 Joined rendezvous version 141 as rank 3. Full state: {'status': 'frozen', 'version': '141', 'participants': [0, 1, 2, 3], 'keep_alives': []}
INFO 2020-03-12 08:16:23,852 Waiting for remaining peers.
INFO 2020-03-12 08:16:23,853 All peers arrived. Confirming membership.
INFO 2020-03-12 08:16:23,931 Confirm membership CAS unsuccessful, retrying
INFO 2020-03-12 08:16:23,994 Confirm membership CAS unsuccessful, retrying
INFO 2020-03-12 08:16:24,073 Waiting for confirmations from all peers.
INFO 2020-03-12 08:16:24,139 Rendezvous version 141 is complete. Final state: {'status': 'final', 'version': '141', 'participants': [0, 1, 2, 3], 'keep_alives': ['/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_2', '/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_1', '/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_3', '/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_0'], 'num_workers_waiting': 0}
INFO 2020-03-12 08:16:24,139 Using TCPStore for c10d::Store implementation
INFO 2020-03-12 08:16:24,151 Rank 3 will conenct to TCPStore server at imagenet-1:53201
[INFO] 2020-03-12 08:16:24,154 coordinator_p2p: Got next rendezvous: rank 3, world size 4
[INFO] 2020-03-12 08:16:24,215 coordinator_p2p: Initialized process group rank 3, world size 4
[INFO] 2020-03-12 08:16:40,051 main: Rank 3: Model state synced from rank: 0
	batch_size=32
	num_data_workers=0
	data_start_index=5248
	iteration=68
	epoch=0/2
[INFO] 2020-03-12 08:16:45,186 train_loop: Rank 3 synced state with other nodes
[INFO] 2020-03-12 08:16:54,623 main: epoch: 0, iteration: 68, data_idx: 7424
[INFO] 2020-03-12 08:17:04,983 main: epoch: 0, iteration: 69, data_idx: 7584
[INFO] 2020-03-12 08:17:17,225 main: epoch: 0, iteration: 70, data_idx: 7744
[INFO] 2020-03-12 08:17:33,425 main: epoch: 0, iteration: 71, data_idx: 7904
[INFO] 2020-03-12 08:17:46,577 main: epoch: 0, iteration: 72, data_idx: 8064
[INFO] 2020-03-12 08:17:58,433 main: epoch: 0, iteration: 73, data_idx: 8224
[INFO] 2020-03-12 08:18:10,957 main: epoch: 0, iteration: 74, data_idx: 8384
[INFO] 2020-03-12 08:18:22,929 main: epoch: 0, iteration: 75, data_idx: 8544
[INFO] 2020-03-12 08:18:38,388 main: epoch: 0, iteration: 76, data_idx: 8704
[INFO] 2020-03-12 08:18:52,919 main: epoch: 0, iteration: 77, data_idx: 8864
[INFO] 2020-03-12 08:19:04,354 main: epoch: 0, iteration: 78, data_idx: 9024
[ERROR] 2020-03-12 08:19:09,751 coordinator_p2p: Rank: 3
Error: [/pytorch/third_party/gloo/gloo/transport/tcp/pair.cc:572] Connection closed by peer [10.244.20.22]:41699
ErrorType: <class 'RuntimeError'>
StackTrace: Traceback (most recent call last):
  File "/opt/conda/lib/python3.6/site-packages/torchelastic/train_loop.py", line 96, in train
    state, worker_stats = train_step(state)
  File "/workspace/elastic/examples/imagenet/main.py", line 316, in train_step
    loss.backward()
  File "/opt/conda/lib/python3.6/site-packages/torch/tensor.py", line 195, in backward
    torch.autograd.backward(self, gradient, retain_graph, create_graph)
  File "/opt/conda/lib/python3.6/site-packages/torch/autograd/__init__.py", line 99, in backward
    allow_unreachable=True)  # allow_unreachable flag
RuntimeError: [/pytorch/third_party/gloo/gloo/transport/tcp/pair.cc:572] Connection closed by peer [10.244.20.22]:41699

INFO 2020-03-12 08:19:10,094 Attempting to join next rendezvous
INFO 2020-03-12 08:19:10,098 Observed existing rendezvous state: {'status': 'final', 'version': '141', 'participants': [0, 1, 2, 3], 'keep_alives': ['/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_2', '/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_1', '/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_3', '/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_0'], 'num_workers_waiting': 1}
INFO 2020-03-12 08:19:10,128 Added self to waiting list. Rendezvous full state: {"status": "final", "version": "141", "participants": [0, 1, 2, 3], "keep_alives": ["/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_2", "/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_1", "/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_3", "/torchelastic/p2p/run_imagenet/rdzv/v_141/rank_0"], "num_workers_waiting": 2}
INFO 2020-03-12 08:19:14,230 Keep-alive key /torchelastic/p2p/run_imagenet/rdzv/v_141/rank_0 is not renewed.
INFO 2020-03-12 08:19:14,230 Rendevous version 141 is incomplete. 
INFO 2020-03-12 08:19:14,230 Attempting to destroy it.
INFO 2020-03-12 08:19:14,245 Rendezvous attempt failed, will retry. Reason: Key not found : /torchelastic/p2p/run_imagenet/rdzv/active_version
INFO 2020-03-12 08:19:15,246 Attempting to join next rendezvous
INFO 2020-03-12 08:19:15,259 Observed existing rendezvous state: {'status': 'joinable', 'version': '142', 'participants': [0]}
INFO 2020-03-12 08:19:15,341 Joined rendezvous version 142 as rank 1. Full state: {'status': 'joinable', 'version': '142', 'participants': [0, 1]}
INFO 2020-03-12 08:19:15,341 Waiting for remaining peers.
